"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[8300],{9871:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var a=s(4848),t=s(8453);const o={sidebar_position:4},c="\u6570\u636e\u6062\u590d",r={id:"manual/ob-operator-user-guide/high-availability/data-recovery-of-ob-operator",title:"\u6570\u636e\u6062\u590d",description:"\u6570\u636e\u6062\u590d\u529f\u80fd\u5728 ob-operator 2.1.0 \u7248\u672c\u4e2d\u5f15\u5165\u3002",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/manual/500.ob-operator-user-guide/300.high-availability/500.data-recovery-of-ob-operator.md",sourceDirName:"manual/500.ob-operator-user-guide/300.high-availability",slug:"/manual/ob-operator-user-guide/high-availability/data-recovery-of-ob-operator",permalink:"/ob-operator/zh-Hans/docs/manual/ob-operator-user-guide/high-availability/data-recovery-of-ob-operator",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/ob-operator/tree/master/docsite/docs/manual/500.ob-operator-user-guide/300.high-availability/500.data-recovery-of-ob-operator.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"manualSidebar",previous:{title:"\u79df\u6237\u5907\u4efd",permalink:"/ob-operator/zh-Hans/docs/manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator"},next:{title:"\u7269\u7406\u5907\u5e93",permalink:"/ob-operator/zh-Hans/docs/manual/ob-operator-user-guide/high-availability/standby-tenant-of-ob-operator"}},i={},l=[{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:2},{value:"\u6570\u636e\u6062\u590d\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e",id:"\u6570\u636e\u6062\u590d\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e",level:2},{value:"\u5e38\u7528\u64cd\u4f5c\u5b9e\u4f8b",id:"\u5e38\u7528\u64cd\u4f5c\u5b9e\u4f8b",level:2},{value:"\u53d1\u8d77\u6570\u636e\u6062\u590d",id:"\u53d1\u8d77\u6570\u636e\u6062\u590d",level:3},{value:"\u67e5\u770b\u6570\u636e\u6062\u590d\u72b6\u6001",id:"\u67e5\u770b\u6570\u636e\u6062\u590d\u72b6\u6001",level:3},{value:"\u67e5\u770b\u79df\u6237\u6062\u590d\u662f\u5426\u6210\u529f",id:"\u67e5\u770b\u79df\u6237\u6062\u590d\u662f\u5426\u6210\u529f",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"\u6570\u636e\u6062\u590d",children:"\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"\u6570\u636e\u6062\u590d\u529f\u80fd\u5728 ob-operator 2.1.0 \u7248\u672c\u4e2d\u5f15\u5165\u3002"})}),"\n",(0,a.jsx)(n.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd\u4ece\u5907\u4efd\u6570\u636e\u6062\u590d\u7684\u65b9\u6cd5\u3002\u6570\u636e\u6062\u590d\u4f9d\u8d56\u5173\u952e\u8d44\u6e90\u4e3a OBTenant \u548c OBTenantRestore\uff0c\u5206\u522b\u8868\u793a\u79df\u6237\u548c\u79df\u6237\u6062\u590d\u4efb\u52a1\u3002\u56e0\u6570\u636e\u6062\u590d\u884c\u4e3a\u7684\u6700\u7ec8\u7ed3\u679c\u662f\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u79df\u6237\uff0c\u6240\u4ee5\u4f7f\u7528\u5728 OBTenant Spec \u4e2d\u7684 Source \u5b57\u6bb5\u6765\u6307\u5b9a\u79df\u6237\u7684\u6062\u590d\u6e90\u3002\u5728\u79df\u6237\u8d44\u6e90\u4e2d\u6307\u5b9a\u4e86\u6570\u636e\u6062\u590d\u76f8\u5173\u7684\u5b57\u6bb5\u4e4b\u540e\uff0cOperator \u4f1a\u521b\u5efa\u51fa OBTenantRestore \u8d44\u6e90\u6765\u6267\u884c\u5177\u4f53\u7684\u6062\u590d\u4efb\u52a1\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u524d\u63d0\u6761\u4ef6",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u5b58\u5728\u6210\u529f\u5907\u4efd\u53ef\u6062\u590d\u7684\u6570\u636e\u3002"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u96c6\u7fa4\u6b63\u5e38\u8fd0\u884c\uff0c\u5e76\u4e14\u5269\u4f59\u8d44\u6e90\u8db3\u591f\u521b\u5efa\u6062\u590d\u79df\u6237\u3002"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"\u5982\u679c\u6062\u590d\u6e90\u4e3a NFS \u7c7b\u578b\uff0c\u9700\u8981\u786e\u5b9a\u6302\u8f7d\u5230 OceanBase \u96c6\u7fa4\u7684\u5907\u4efd Volume \u53ef\u7528\u3002"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u6570\u636e\u6062\u590d\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e",children:"\u6570\u636e\u6062\u590d\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e"}),"\n",(0,a.jsx)(n.p,{children:"\u6062\u590d\u6570\u636e\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u79df\u6237\u7ba1\u7406\u5f53\u4e2d\u6240\u63d0\u5230\u7684 OBTenant \u8d44\u6e90\u63cf\u8ff0\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:"tenant_restore.yaml",children:'apiVersion: oceanbase.oceanbase.com/v1alpha1  \nkind: OBTenant  \nmetadata:  \n  name: t1s\n  # namespace: oceanbase\nspec: \n  obcluster: obcluster\n  tenantName: t1s\n  unitNum: 1 \n  tenantRole: STANDBY\n  source:\n    restore:\n      bakDataSource: \n        # type: "NFS"\n        # path: "t1/dataBackup"\n        type: "OSS"\n        path: "oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com"\n        ossAccessSecret: "oss-access"\n      archiveSource:\n        # type: "NFS"\n        # path: "t1/logArchive"\n        type: "OSS"\n        path: "oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com"\n        ossAccessSecret: "oss-access"\n      until: \n        unlimited: true\n      replayLogUntil:\n        unlimited: true\n    tenant: t1\n  fields: values\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u6570\u636e\u6062\u590d\u76f8\u5173\u914d\u7f6e\u8bf4\u660e\u5982\u4e0b\uff1a"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["tenantRole\uff1a \u9700\u8981\u521b\u5efa\u7684\u79df\u6237\u7684\u89d2\u8272\uff0c\u53ef\u9009\u503c\u4e3a PRIMARY \u548c STANDBY\uff0c\u5206\u522b\u4ee3\u8868\u4e3b\u79df\u6237\u548c\u5907\u79df\u6237\u3002\u5982\u679c\u4e0d\u6307\u5b9a\uff0c\u9ed8\u8ba4\u4e3a PRIMARY\uff1b\u6709\u5173\u5907\u79df\u6237/\u7269\u7406\u5907\u5e93\u7684\u8bf4\u660e\u6587\u6863\uff0c\u8bf7\u67e5\u770b",(0,a.jsx)(n.a,{href:"/ob-operator/zh-Hans/docs/manual/ob-operator-user-guide/high-availability/standby-tenant-of-ob-operator",children:"\u7269\u7406\u5907\u5e93"})]}),"\n",(0,a.jsxs)(n.li,{children:["source\uff1a \u79df\u6237\u6570\u636e\u6765\u6e90","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["restore\uff1a \u5907\u4efd\u6570\u636e\u6062\u590d\u6e90","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"bakDataSource\uff1a \u5907\u4efd\u6570\u636e\u6062\u590d\u7684\u76ee\u6807\u5730\u5740\uff0c\u4e0e\u6570\u636e\u5907\u4efd\u4e2d\u6570\u636e\u5907\u4efd\u76ee\u7684\u5730\u914d\u7f6e\u76f8\u540c"}),"\n",(0,a.jsx)(n.li,{children:"archiveSource\uff1a \u65e5\u5fd7\u5f52\u6863\u6062\u590d\u7684\u76ee\u6807\u5730\u5740\uff0c\u540c\u4e0a"}),"\n",(0,a.jsxs)(n.li,{children:["until\uff1a \u6570\u636e\u6062\u590d\u7684\u622a\u6b62\u4f4d\u70b9","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"unlimited\uff1a \u6062\u590d\u5230\u6700\u65b0\u4f4d\u70b9"}),"\n",(0,a.jsxs)(n.li,{children:["timestamp\uff1a \u9700\u8981\u6062\u590d\u5230\u7684\u65f6\u95f4\u6233\uff0c\u683c\u5f0f\u4e3a YYYY-MM-DD HH:mm",":ss","\uff0c\u4f8b\u5982 2023-11-10 09:00:00"]}),"\n",(0,a.jsx)(n.li,{children:"scn\uff1a \u9700\u8981\u6062\u590d\u5230\u7684 SCN"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["replayLogUntil\uff1a \u4f5c\u4e3a\u6570\u636e\u6062\u590d\u622a\u6b62\u4f4d\u70b9\u7684\u8865\u5145\uff0c\u8868\u793a\u5728\u6570\u636e\u6062\u590d\u4e4b\u540e\u7ee7\u7eed\u56de\u653e\u4e3b\u79df\u6237\u65e5\u5fd7\u5230\u6307\u5b9a\u7684\u4f4d\u70b9\uff0c\u4ec5\u5728\u6062\u590d\u6210\u4e3a\u5907\u79df\u6237\u4e14\u6570\u636e\u6062\u590d\u622a\u6b62\u4f4d\u70b9\u6ca1\u6709\u8bbe\u7f6e\u4e3a\u6700\u65b0\u4f4d\u70b9\u65f6\u751f\u6548\uff0c\u914d\u7f6e\u4e0e ",(0,a.jsx)(n.code,{children:"until"})," \u76f8\u540c"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"tenant\uff1a \u6307\u5b9a\u4e3b\u79df\u6237\uff0c\u4ec5\u5728\u6062\u590d\u6210\u4e3a\u5907\u79df\u6237\u65f6\u751f\u6548"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"\u5176\u4ed6\u914d\u7f6e\u4e0e\u6b63\u5e38\u79df\u6237\u7684\u914d\u7f6e\u76f8\u540c"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u5e38\u7528\u64cd\u4f5c\u5b9e\u4f8b",children:"\u5e38\u7528\u64cd\u4f5c\u5b9e\u4f8b"}),"\n",(0,a.jsx)(n.h3,{id:"\u53d1\u8d77\u6570\u636e\u6062\u590d",children:"\u53d1\u8d77\u6570\u636e\u6062\u590d"}),"\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u53d1\u8d77\u79df\u6237\u6570\u636e\u6062\u590d\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f tenant_restore.yaml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u67e5\u770b\u6570\u636e\u6062\u590d\u72b6\u6001",children:"\u67e5\u770b\u6570\u636e\u6062\u590d\u72b6\u6001"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u5f85\u6062\u590d\u79df\u6237\u7684\u72b6\u6001\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl get obtenants.oceanbase.oceanbase.com -n oceanbase\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"NAME   STATUS      TENANTNAME   TENANTROLE   CLUSTERNAME   AGE\nt1s    restoring   t1s          STANDBY      obcluster     27s\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u521b\u5efa\u7684\u79df\u6237\u6062\u590d\u4efb\u52a1\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl get obtenantrestores.oceanbase.oceanbase.com -n oceanbase\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"NAME          STATUS    AGE    TARGETTENANT   TARGETCLUSTER   RESTOREROLE   STATUSINDB\nt1s-restore   RUNNING   113s   t1s            obcluster       STANDBY       WAIT_TENANT_RESTORE_FINISH\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u79df\u6237\u6062\u590d\u4efb\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"kubectl describe obtenantrestores.oceanbase.oceanbase.com -n oceanbase\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8fd4\u56de\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"Name:         t1s-restore\nNamespace:    oceanbase\nLabels:       oceanbase.oceanbase.com/tenant-name=t1s\n            ref-obcluster=obcluster\n            ref-uid=b9317541-6566-4ac0-84fb-9a4c6fca03ba\nAnnotations:  <none>\nAPI Version:  oceanbase.oceanbase.com/v1alpha1\nKind:         OBTenantRestore\nMetadata:\nCreation Timestamp:  2023-11-13T03:13:26Z\nGeneration:          1\nOwner References:\n  API Version:           oceanbase.oceanbase.com/v1alpha1\n  Block Owner Deletion:  true\n  Kind:                  OBTenant\n  Name:                  t1s\n  UID:                   b9317541-6566-4ac0-84fb-9a4c6fca03ba\nResource Version:        927784\nUID:                     e439a060-9758-4074-a170-661d3e23a836\nSpec:\nPrimary Tenant:  t1\nRestore Option:  pool_list=pool_t1s_zone1&primary_zone=zone1;&locality=FULL{1}@zone1\nRestore Role:    STANDBY\nSource:\n  Archive Source:\n    Oss Access Secret:  oss-access\n    Path:               oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com\n    Type:               OSS\n  Bak Data Source:\n    Oss Access Secret:  oss-access\n    Path:               oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com\n    Type:               OSS\n  Replay Log Until:\n    Unlimited:  true\n  Until:\n    Unlimited:   true\nTarget Cluster:  obcluster\nTarget Tenant:   t1s\nStatus:\nRestore Progress:\n  backup_cluster_name:     obcluster\n  backup_cluster_version:  \n  backup_dest:             oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com&access_id=xxx&access_key=yyy,oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com&access_id=xxx&access_key=yyy\n  backup_piece_list:       oss://bucket/archive/piece_d1005r10p10?host=oss-cn-hangzhou.aliyuncs.com&access_id=xxx&access_key=yyy\n  backup_set_list:         oss://bucket/backup/backup_set_25_full?host=oss-cn-hangzhou.aliyuncs.com&access_id=xxx&access_key=yyy,oss://bucket/backup/backup_set_26_inc?host=oss-cn-hangzhou.aliyuncs.com&access_id=xxx&access_key=yyy\n  backup_tenant_id:        1016\n  backup_tenant_name:      t1\n  Description:             \n  finish_ls_count:         0\n  finish_tablet_count:     0\n  finish_timestamp:        \n  job_id:                  5\n  ls_count:                0\n  restore_option:          pool_list=pool_t1s_zone1&primary_zone=zone1;&locality=FULL{1}@zone1\n  restore_scn:             1697098764718466986\n  restore_scn_display:     2023-10-12 16:19:24.718466\n  restore_tenant_id:       1004\n  restore_tenant_name:     t1s\n  start_timestamp:         2023-11-13 11:13:46.220513\n  Status:                  WAIT_TENANT_RESTORE_FINISH\n  tablet_count:            0\n  tenant_id:               1\nStatus:                    RUNNING\nEvents:                      <none>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u67e5\u770b\u79df\u6237\u6062\u590d\u662f\u5426\u6210\u529f",children:"\u67e5\u770b\u79df\u6237\u6062\u590d\u662f\u5426\u6210\u529f"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u8fde\u63a5 sys \u79df\u6237\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"mysql -h$(kubectl get pods -l ref-obcluster=test -o jsonpath='{.items[0].status.podIP}') -P2881 -uroot oceanbase -A -c\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u67e5\u770b\u9700\u6062\u590d\u7684\u79df\u6237\u662f\u5426\u6062\u590d\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"select * from DBA_OB_TENANTS;\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>r});var a=s(6540);const t={},o=a.createContext(t);function c(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);