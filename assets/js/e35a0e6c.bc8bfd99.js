"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[8785],{7944:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>l});var t=a(4848),s=a(8453);const c={sidebar_position:3},o="Back up a tenant",i={id:"manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator",title:"Back up a tenant",description:"This topic describes how to back up the data of a tenant. OBTenantBackupPolicy and OBTenantBackup resources are key to tenant data backup. You can use OBTenantBackupPolicy to define backup policies and OBTenantBackup to define backup jobs. A backup policy specifies the interval of log archiving and data backup parameters for a tenant in an OceanBase cluster. When a backup policy takes effect, a backup job is created to execute specific operations. The backup destination can be a Network File System (NFS) volume or an Alibaba Cloud Object Storage Service (OSS) bucket.",source:"@site/docs/manual/500.ob-operator-user-guide/300.high-availability/400.tenant-backup-of-ob-operator.md",sourceDirName:"manual/500.ob-operator-user-guide/300.high-availability",slug:"/manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/ob-operator/tree/master/docsite/docs/manual/500.ob-operator-user-guide/300.high-availability/400.tenant-backup-of-ob-operator.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"manualSidebar",previous:{title:"Recover from node failure",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/disaster-recovery-of-ob-operator"},next:{title:"Restore data from a backup",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/data-recovery-of-ob-operator"}},r={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure backup policies",id:"configure-backup-policies",level:2},{value:"Sample configurations",id:"sample-configurations",level:3},{value:"Configuration description",id:"configuration-description",level:3},{value:"Common operations",id:"common-operations",level:2},{value:"Initiate a backup job",id:"initiate-a-backup-job",level:3},{value:"View the status of the backup policy",id:"view-the-status-of-the-backup-policy",level:3},{value:"View the status of the backup job",id:"view-the-status-of-the-backup-job",level:3},{value:"View details of the backup policy",id:"view-details-of-the-backup-policy",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"back-up-a-tenant",children:"Back up a tenant"}),"\n",(0,t.jsx)(n.p,{children:"This topic describes how to back up the data of a tenant. OBTenantBackupPolicy and OBTenantBackup resources are key to tenant data backup. You can use OBTenantBackupPolicy to define backup policies and OBTenantBackup to define backup jobs. A backup policy specifies the interval of log archiving and data backup parameters for a tenant in an OceanBase cluster. When a backup policy takes effect, a backup job is created to execute specific operations. The backup destination can be a Network File System (NFS) volume or an Alibaba Cloud Object Storage Service (OSS) bucket."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"To back up data to an NFS volume, make sure that backup volume has been configured when the OceanBase cluster is deployed and can be accessed, and that you have the read and write permissions on the NFS volume."}),"\n",(0,t.jsx)(n.h2,{id:"configure-backup-policies",children:"Configure backup policies"}),"\n",(0,t.jsx)(n.h3,{id:"sample-configurations",children:"Sample configurations"}),"\n",(0,t.jsx)(n.p,{children:"You can use the configuration file to specify a backup policy for a specific tenant. Here is an example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: oceanbase.oceanbase.com/v1alpha1\nkind: OBTenantBackupPolicy\nmetadata:\n  name: backup-policy-example\n  namespace: oceanbase\nspec:\n  obClusterName: "test"\n  tenantName: "t1"\n  tenantSecret: "t1-credential"\n  tenantCRName: "tenant-cr"\n  jobKeepWindow: "1d"\n  suspend: false\n  dataClean:\n    recoveryWindow: "8d"\n  logArchive:\n    destination:\n      type: "OSS"\n      path: "oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com"\n      ossAccessSecret: "oss-access"\n      # type: "NFS"\n      # path: "t1/logArchive"\n    switchPieceInterval: "1d"\n    binding: Optional\n  dataBackup:\n    destination:\n      type: "OSS"\n      path: "oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com"\n      ossAccessSecret: "oss-access"\n      # type: "NFS"\n      # path: "t1/dataBackup"\n    fullCrontab: "30 0 * * 6"\n    incrementalCrontab: "30 1 * * *"\n    encryptionSecret: t1-encryption\n'})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-description",children:"Configuration description"}),"\n",(0,t.jsx)(n.p,{children:"The parameters are described as follows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"obClusterName: the name of the OceanBase cluster in the same namespace."}),"\n",(0,t.jsx)(n.li,{children:"tenantName: the tenant name in the OceanBase cluster."}),"\n",(0,t.jsxs)(n.li,{children:["tenantSecret: the name of the secret resource that contains the password of the root user of the specified tenant, whose name is the value of the ",(0,t.jsx)(n.code,{children:"tenantName"})," parameter."]}),"\n",(0,t.jsxs)(n.li,{children:["tenantCRName: the name of the custom resources of the OceanBase Database tenant. If you specify this parameter, you do not need to specify the ",(0,t.jsx)(n.code,{children:"tenantName"})," or ",(0,t.jsx)(n.code,{children:"tenantSecret"})," parameter."]}),"\n",(0,t.jsx)(n.li,{children:"jobKeepWindow: the time window for which the resources for a backup job are retained."}),"\n",(0,t.jsxs)(n.li,{children:["suspend: specifies whether the backup job can be suspended. The default value is ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["dataClean: the configuration for the cleanup of expired backup data.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"recoveryWindow: the time window for data recovery."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["logArchive: the configuration for log archiving.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"destination: the destination of the backup data."}),"\n",(0,t.jsxs)(n.li,{children:["switchPieceInterval: the switching interval of pieces of archived logs. The value range is ",(0,t.jsx)(n.code,{children:"[1d,7d]"}),". The default value is ",(0,t.jsx)(n.code,{children:"1d"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["binding: the mode for prioritizing archiving and business. ",(0,t.jsx)(n.code,{children:"Optional"})," and ",(0,t.jsx)(n.code,{children:"Mandatory"})," modes are supported. By default, ",(0,t.jsx)(n.code,{children:"Optional"})," mode is used."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["dataBackup: the configuration for data backup.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"destination: the destination of the backup data."}),"\n",(0,t.jsxs)(n.li,{children:["fullCrontab: the scheduled timestamp, in the cron expression format, when a full data backup job is triggered. For more information, visit ",(0,t.jsx)(n.a,{href:"https://crontab.guru/",children:"https://crontab.guru/"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["incrementalCrontab: the scheduled timestamp, in the cron expression format, when an incremental data backup job is triggered. For more information, visit ",(0,t.jsx)(n.a,{href:"https://crontab.guru/",children:"https://crontab.guru/"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"encryptionSecret: the name of the secret resource for data backup encryption."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The parameters are described as follows:"}),"\n",(0,t.jsx)(n.p,{children:"destination:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["type: the type of the destination. Valid values are ",(0,t.jsx)(n.code,{children:"NFS"})," and ",(0,t.jsx)(n.code,{children:"OSS"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["path: the path of the backup destination. If you use an OSS backup destination, the path must start with ",(0,t.jsx)(n.code,{children:"oss://"}),". If you use an NFS backup destination, you must specify a relative path, which must not start with ",(0,t.jsx)(n.code,{children:"/"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"ossAccessSecret: the name of the secret resource that stores the OSS access credential. If you use an OSS backup destination, you must specify this parameter."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here is the configuration of a sample tenantSecret resource:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: tenant-root\n  namespace: oceanbase\ndata:\n  # base64 encoded\n  password: ******\n"})}),"\n",(0,t.jsx)(n.p,{children:"Here is the configuration of a sample encryptionSecret resource:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: tenant-backup-encryption\n  namespace: oceanbase\ndata:\n  # base64 encoded\n  password: ******\n"})}),"\n",(0,t.jsx)(n.p,{children:"Here is the configuration of a sample ossAccessSecret resource:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: oss-access\n  namespace: obcluster\ndata:\n  # base64 encoded\n  accessId: ******\n  accessKey: ******\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-operations",children:"Common operations"}),"\n",(0,t.jsx)(n.h3,{id:"initiate-a-backup-job",children:"Initiate a backup job"}),"\n",(0,t.jsx)(n.p,{children:"Specify the name of the related secret resource as needed and run the following command to create the secret resource:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f tenant-secret.yaml\nkubectl apply -f backup-encryption.yaml\nkubectl apply -f oss-access.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the following command to create a tenant backup policy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f backup-policy.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-the-status-of-the-backup-policy",children:"View the status of the backup policy"}),"\n",(0,t.jsx)(n.p,{children:"Run the following command to view the status of the backup policy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get obtenantbackuppolicies.oceanbase.oceanbase.com -n oceanbase\n"})}),"\n",(0,t.jsx)(n.p,{children:"The command output is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"NAME                       STATUS    AGE     TENANTNAME   NEXTFULL              NEXTINCREMENTAL   FULLCRONTAB    INCREMENTALCRONTAB\nbackup-policy-example      RUNNING   2m46s   t1           2023-11-10 11:07:58                     */60 * * * *   */25 * * * *\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-the-status-of-the-backup-job",children:"View the status of the backup job"}),"\n",(0,t.jsx)(n.p,{children:"When a backup policy takes effect, a backup job is created to execute specific operations. You can run the following command to view the status of a backup job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get obtenantbackups.oceanbase.oceanbase.com -n oceanbase\n"})}),"\n",(0,t.jsx)(n.p,{children:"The command output is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"NAME                                              TYPE      STATUS       TENANTNAME   STARTEDAT                    ENDEDAT\nbackup-policy-example-clean-20231110110746        CLEAN     RUNNING      t1                                        \nbackup-policy-example-full-20231110110756         FULL      SUCCESSFUL   t1           2023-11-10 11:08:06.952711   2023-11-10 11:13:31.079246\nbackup-policy-example-archive-20231110110746      ARCHIVE   RUNNING      t1           2023-11-10 11:07:50.139978   2023-11-10 11:13:50.128627\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-details-of-the-backup-policy",children:"View details of the backup policy"}),"\n",(0,t.jsx)(n.p,{children:"You can view details of the backup policy by running the following two commands."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run the ",(0,t.jsx)(n.code,{children:"kubectl get -o yaml"})," command:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get -n oceanbase obtenantbackuppolicies.oceanbase.oceanbase.com backup-policy-example -o yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"The command output is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: oceanbase.oceanbase.com/v1alpha1\nkind: OBTenantBackupPolicy\nmetadata:\n  creationTimestamp: "2023-11-10T03:07:39Z"\n  finalizers:\n  - obtenantbackuppolicy.finalizers.oceanbase.com\n  generation: 1\n  name: backup-policy-example\n  namespace: oceanbase\n  resourceVersion: "775461"\n  uid: 7ab40200-f849-434d-b1a5-6aad888cf42e\nspec:\n  dataBackup:\n    destination:\n      ossAccessSecret: oss-access\n      path: oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com\n      type: OSS\n    fullCrontab: \'*/60 * * * *\'\n    incrementalCrontab: \'*/25 * * * *\'\n    encryptionSecret: t1-encryption\n  dataClean:\n    recoveryWindow: 8d\n  jobKeepWindow: 1d\n  logArchive:\n    destination:\n      ossAccessSecret: oss-access\n      path: oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com\n      type: OSS\n    switchPieceInterval: 1d\n  obClusterName: test\n  tenantName: t1\n  tenantSecret: t1-credential\nstatus:\n  latestArchiveLogJob:\n    fields: values...\n  latestFullBackupJob:\n    fields: values...\n  nextFull: "2023-11-10 12:00:00"\n  nextIncremental: "2023-11-10 11:25:00"\n  observedGeneration: 1\n  status: RUNNING\n  tenantCR:\n    fields: values...\n  tenantInfo:\n    fields: values...\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run the ",(0,t.jsx)(n.code,{children:"kubectl describe"})," command:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl describe -n oceanbase obtenantbackuppolicies.oceanbase.oceanbase.com backup-policy-example\n"})}),"\n",(0,t.jsx)(n.p,{children:"The command output is as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"Name:         backup-policy-example\nNamespace:    oceanbase\nLabels:       <none>\nAnnotations:  <none>\nAPI Version:  oceanbase.oceanbase.com/v1alpha1\nKind:         OBTenantBackupPolicy\nMetadata:\n  Creation Timestamp:  2023-11-10T03:07:39Z\n  Finalizers:\n    obtenantbackuppolicy.finalizers.oceanbase.com\n  Generation:        1\n  Resource Version:  775477\n  UID:               7ab40200-f849-434d-b1a5-6aad888cf42e\nSpec:\n  Data Backup:\n    Destination:\n      Oss Access Secret:  oss-access\n      Path:               oss://bucket/backup?host=oss-cn-hangzhou.aliyuncs.com\n      Type:               OSS\n    Full Crontab:         */60 * * * *\n    Incremental Crontab:  */25 * * * *\n    Encryption Secret:    t1-encryption\n  Data Clean:\n    Recovery Window:  8d\n  Job Keep Window:    1d\n  Log Archive:\n    Destination:\n      Oss Access Secret:    oss-access\n      Path:                 oss://bucket/archive?host=oss-cn-hangzhou.aliyuncs.com\n      Type:                 OSS\n    Switch Piece Interval:  1d\n  Ob Cluster Name:          test\n  Tenant Name:              t1\n  Tenant Secret:            t1-credential\nStatus:\n  Latest Archive Log Job:\n    fields: values...\n  Latest Full Backup Job:\n    fields: values...\n  Next Full:             2023-11-10 12:00:00\n  Next Incremental:      2023-11-10 11:25:00\n  Observed Generation:   1\n  Status:                RUNNING\n  Tenant CR:\n    fields: values...\n  Tenant Info:\n    fields: values...\nEvents:\n  Type    Reason  Age   From                             Message\n  ----    ------  ----  ----                             -------\n  Normal          12m   obtenantbackuppolicy-controller  init status\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>i});var t=a(6540);const s={},c=t.createContext(s);function o(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);