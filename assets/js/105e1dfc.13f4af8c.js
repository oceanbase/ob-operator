"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[8736],{3123:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>d});var t=r(4848),a=r(8453);const i={sidebar_position:2},s="Restore service from node failure",n={id:"manual/ob-operator-user-guide/high-availability/disaster-recovery-of-ob-operator",title:"Restore service from node failure",description:"This topic describes how to handle the faults of OBServer nodes by using ob-operator.",source:"@site/docs/manual/500.ob-operator-user-guide/300.high-availability/300.disaster-recovery-of-ob-operator.md",sourceDirName:"manual/500.ob-operator-user-guide/300.high-availability",slug:"/manual/ob-operator-user-guide/high-availability/disaster-recovery-of-ob-operator",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/disaster-recovery-of-ob-operator",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/manual/500.ob-operator-user-guide/300.high-availability/300.disaster-recovery-of-ob-operator.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"manualSidebar",previous:{title:"High availability",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/high-availability-intro"},next:{title:"Back up a tenant",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator"}},l={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Restore policy",id:"restore-policy",level:2},{value:"Verification",id:"verification",level:2},{value:"Deployment suggestions",id:"deployment-suggestions",level:2}];function c(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"restore-service-from-node-failure",children:"Restore service from node failure"}),"\n",(0,t.jsx)(o.p,{children:"This topic describes how to handle the faults of OBServer nodes by using ob-operator."}),"\n",(0,t.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"You must deploy an OceanBase cluster with at least 3 OBServer nodes and a tenant with 3 replicas or above."}),"\n",(0,t.jsxs)(o.li,{children:["To use the static IP address feature, you must install ",(0,t.jsx)(o.code,{children:"Calico"})," as the network plugin for the Kubernetes cluster."]}),"\n"]}),"\n",(0,t.jsx)(o.h2,{id:"restore-policy",children:"Restore policy"}),"\n",(0,t.jsx)(o.p,{children:"When a minority of OBServer nodes fail, the multi-replica mechanism of OceanBase Database ensures the availability of the cluster, and ob-operator detects a pod exception. Then, ob-operator creates an OBServer node, adds it to the cluster, and deletes the abnormal OBServer node.\nOceanBase Database replicates the data of replicas on the abnormal OBServer node to the new node."}),"\n",(0,t.jsx)(o.p,{children:"If you have installed Calico for the Kubernetes cluster, this process can be easier. ob-operator can start a new observer process by using the IP address of the abnormal OBServer node. This way, the data on the abnormal OBServer node, if the data still exists, can be directly used without the replication step. Moreover, if a majority of OBServer nodes fail, this method can also restore the service after all new OBServer nodes are started."}),"\n",(0,t.jsx)(o.h2,{id:"verification",children:"Verification"}),"\n",(0,t.jsx)(o.p,{children:"You can verify the restore result of ob-operator by performing the following steps."}),"\n",(0,t.jsx)(o.p,{children:"Delete the pod"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"kubectl delete pod obcluster-1-zone1-074bda77c272 -n oceanbase\n"})}),"\n",(0,t.jsx)(o.p,{children:"View the restore result. The output shows that the pod of zone1 has been created and is ready."}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-shell",children:"kubectl get pods -n oceanbase\n\nNAME                                  READY   STATUS    RESTARTS   AGE\nobcluster-1-zone3-074bda77c272        2/2     Running   0          12d\nobcluster-1-zone2-7ecbd89f84de        2/2     Running   0          12d\nobcluster-1-zone1-94ecf05cb290        2/2     Running   0          1m\n"})}),"\n",(0,t.jsx)(o.h2,{id:"deployment-suggestions",children:"Deployment suggestions"}),"\n",(0,t.jsxs)(o.p,{children:["To deploy a production cluster with high availability, we recommend that you deploy an OceanBase cluster of at least three OBServer nodes, create tenants that each has at least three replicas, distribute nodes of each zone on different servers, and use the network plug-in Calico. This minimizes the risk of an unrecoverable cluster disaster. ob-operator also provides high-availability solutions based on the backup and restore of tenant data and the primary and standby tenants. For more information, see ",(0,t.jsx)(o.a,{href:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/data-recovery-of-ob-operator",children:"Restore data from a backup"})," and ",(0,t.jsx)(o.a,{href:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/tenant-backup-of-ob-operator",children:"Back up a tenant"}),"."]})]})}function u(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,o,r)=>{r.d(o,{R:()=>s,x:()=>n});var t=r(6540);const a={},i=t.createContext(a);function s(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function n(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);