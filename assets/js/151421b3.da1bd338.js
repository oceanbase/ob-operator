"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[7860],{9851:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var t=r(4848),n=r(8453);const a={sidebar_position:6},o="Inter K8s cluster management",i={id:"manual/ob-operator-user-guide/high-availability/inter-k8s-cluster-management",title:"Inter K8s cluster management",description:"This feature is available in ob-operator version 2.3.0 and later.",source:"@site/docs/manual/500.ob-operator-user-guide/300.high-availability/700.inter-k8s-cluster-management.md",sourceDirName:"manual/500.ob-operator-user-guide/300.high-availability",slug:"/manual/ob-operator-user-guide/high-availability/inter-k8s-cluster-management",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/inter-k8s-cluster-management",draft:!1,unlisted:!1,editUrl:"https://github.com/oceanbase/ob-operator/tree/master/docsite/docs/manual/500.ob-operator-user-guide/300.high-availability/700.inter-k8s-cluster-management.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"manualSidebar",previous:{title:"Physical standby tenant",permalink:"/ob-operator/docs/manual/ob-operator-user-guide/high-availability/standby-tenant-of-ob-operator"},next:{title:"Appendix",permalink:"/ob-operator/docs/category/appendix"}},c={},l=[{value:"Architecture",id:"architecture",level:2},{value:"How to add <code>worker</code> K8s Cluster",id:"how-to-add-worker-k8s-cluster",level:2},{value:"Create OceanBase Cluster across multiple K8s clusters",id:"create-oceanbase-cluster-across-multiple-k8s-clusters",level:2},{value:"Managing OceanBase Cluster in multiple K8s clusters",id:"managing-oceanbase-cluster-in-multiple-k8s-clusters",level:2}];function u(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"inter-k8s-cluster-management",children:"Inter K8s cluster management"}),"\n",(0,t.jsx)(s.admonition,{type:"tip",children:(0,t.jsx)(s.p,{children:"This feature is available in ob-operator version 2.3.0 and later.\nPrerequisite: Pod and service connectivity must be established across all K8s clusters involved."})}),"\n",(0,t.jsx)(s.p,{children:"Deploying workloads across multiple K8s clusters enhances scalability, reliability, and security. By deploying zones (obzones) across different K8s clusters, you can fully leverage OceanBase's high-availability design. This approach provides disaster tolerance at the K8s cluster level, making operations more resilient."}),"\n",(0,t.jsx)(s.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"inter-k8s-cluster-architecture",src:r(7015).A+"",width:"1624",height:"982"})}),"\n",(0,t.jsx)(s.p,{children:"As shown in the architecture diagram, K8s clusters play different roles. The cluster running the ob-operator is referred to as the master cluster, while the other clusters are called worker clusters.\nWorker clusters are registered by creating a custom resource of type K8sCluster in the master cluster. The ob-operator accesses these worker clusters using credentials stored in these resources. While OceanBase workloads run as native K8s resources in the worker clusters, the custom resources for OceanBase remain in the master cluster."}),"\n",(0,t.jsxs)(s.h2,{id:"how-to-add-worker-k8s-cluster",children:["How to add ",(0,t.jsx)(s.code,{children:"worker"})," K8s Cluster"]}),"\n",(0,t.jsxs)(s.p,{children:["To add a worker cluster, ensure the credentials used for access have permissions to ",(0,t.jsx)(s.code,{children:"get"}),", ",(0,t.jsx)(s.code,{children:"list"}),", ",(0,t.jsx)(s.code,{children:"watch"}),", ",(0,t.jsx)(s.code,{children:"create"}),", ",(0,t.jsx)(s.code,{children:"update"}),", ",(0,t.jsx)(s.code,{children:"patch"})," and ",(0,t.jsx)(s.code,{children:"delete"})," resources of type ",(0,t.jsx)(s.code,{children:"pod"}),", ",(0,t.jsx)(s.code,{children:"service"}),", ",(0,t.jsx)(s.code,{children:"pvc"}),", ",(0,t.jsx)(s.code,{children:"job"})," and ",(0,t.jsx)(s.code,{children:"namespace"}),". Follow the example below to create a K8sCluster resource by replacing the placeholder under kubeConfig with your worker cluster\u2019s credentials, then apply it to the master cluster."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",metastring:"k8s_cluster.yaml",children:'apiVersion: k8s.oceanbase.com/v1alpha1\nkind: K8sCluster\nmetadata:\n  name: k8s-remote\nspec:\n  name: remote\n  description: "This is the remote k8s cluster for testing"\n  kubeConfig: |\n    <Your K8s credential> # Typically you can found it in ~/.kube/config\n'})}),"\n",(0,t.jsx)(s.p,{children:"Verify the resource using the following command"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl get k8scluster\n"})}),"\n",(0,t.jsx)(s.p,{children:"The expected output should look like this"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"NAME         AGE   CLUSTERNAME\nk8s-remote   1m    remote\n"})}),"\n",(0,t.jsx)(s.h2,{id:"create-oceanbase-cluster-across-multiple-k8s-clusters",children:"Create OceanBase Cluster across multiple K8s clusters"}),"\n",(0,t.jsx)(s.p,{children:"To create an OceanBase cluster across multiple K8s clusters, the only difference compared with deploy it in a single K8s cluster is to specify in which K8s cluster the obzone should be created, you may reference the following example."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",metastring:"multi-k8s-cluster.yaml",children:'apiVersion: oceanbase.oceanbase.com/v1alpha1\nkind: OBCluster\nmetadata:\n  name: test\n  namespace: default\n  # annotations:\n  #  "oceanbase.oceanbase.com/independent-pvc-lifecycle": "true"\n  #  "oceanbase.oceanbase.com/mode": "service"\nspec:\n  clusterName: test\n  clusterId: 1\n  userSecrets:\n    root: root-password\n  topology:\n    - zone: zone1\n      replica: 1\n    - zone: zone2\n      replica: 1\n      k8sCluster: k8s-cluster-hz\n    - zone: zone3\n      replica: 1\n      k8sCluster: k8s-cluster-sh\n  observer:\n    image: oceanbase/oceanbase-cloud-native:4.2.1.7-107000162024060611\n    resource:\n      cpu: 2\n      memory: 10Gi\n    storage:\n      dataStorage:\n        storageClass: local-path\n        size: 50Gi\n      redoLogStorage:\n        storageClass: local-path\n        size: 50Gi\n      logStorage:\n        storageClass: local-path\n        size: 20Gi\n  parameters:\n  - name: system_memory\n    value: 1G\n  - name: "__min_full_resource_pool_memory"\n    value: "2147483648" # 2G\n'})}),"\n",(0,t.jsx)(s.h2,{id:"managing-oceanbase-cluster-in-multiple-k8s-clusters",children:"Managing OceanBase Cluster in multiple K8s clusters"}),"\n",(0,t.jsx)(s.p,{children:"Managing an OceanBase cluster across multiple K8s clusters remains straightforward. Simply modify the custom resources in the master cluster, and the ob-operator will synchronize the changes with the relevant resources in the worker clusters."})]})}function d(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},7015:(e,s,r)=>{r.d(s,{A:()=>t});const t=r.p+"assets/images/inter-k8s-cluster-architecture-b74f88d97ebb8df7ba6d92c01fb3d56f.jpg"},8453:(e,s,r)=>{r.d(s,{R:()=>o,x:()=>i});var t=r(6540);const n={},a=t.createContext(n);function o(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);